<head>
<BASE href="file:///tmp/matlab_comparison_report_4087888492606550305.html" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Comparison Tool - ...ural_preproc_local_STANDARD.m vs. /home/...re/structural_preproc.m</title><style type="text/css">

pre {

  display:inline;

}

.diffnomatch {

  background: #e5d5e8;

}

.right {

  background: #dbf2fc;

}

.left {

  background: #f3e9d1;

}

.diffsoft {

  color: #888;

}

.diffskip {

  color: #888;

  background: #e0e0e0;

}

.bold {

  font-weight:bold;

}

.merged {

  background-color: #eaeaea;

}

</style></head><body><div id="allContent"><table cellpadding="0" cellspacing="0" border="0"><tbody><tr>
<td></td><td><a id="leftFileLink" class="bold">structural_preproc_local_STANDARD.m</a></td>
<td><a id="rightFileLink" class="bold">structural_preproc.m</a></td>
</tr>
<tr>
<td></td><td>/home/michele/Documents/FastTrack_fullSample/SCRIPTS/structural_preproc_local_STANDARD.m</td><td>/home/michele/Documents/FastTrack_fullSample/orig_software/structural_preproc.m</td>
</tr>
<tr>
<td></td><td>Thu Feb 20 15:47:28 GMT 2020</td><td>Thu Aug 15 10:37:12 BST 2019</td>
</tr>
<tr>
<td><pre>    </pre></td>
<td><pre>                                                                                  </pre></td>
<td><pre>                                                                                </pre></td>
</tr></tbody></table>
<div>35 differences found.  Use the toolstrip buttons to navigate to them.</div><div id="diffstart">
<br><pre><div id="ignorediv"><a id="ignorelink"></a></div>
                                                                       <span class="diffskip">[5 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="6" data-right-line="6"><a>  6</a> %%%%%%%%%%%%%%%%%                                                                . %%%%%%%%%%%%%%%%%                                                                <span><a>  6</a></span></span>
<span class="nodiff" data-left-line="7" data-right-line="7"><a>  7</a>                                                                                  .                                                                                  <span><a>  7</a></span></span>
<span class="nodiff" data-left-line="8" data-right-line="8"><a>  8</a> %% setup                                                                         . %% setup                                                                         <span><a>  8</a></span></span>
<div id="diff0" onclick="select('diff0')"><span class="diffLine" data-left-line="9" data-right-line="9"><a>  9</a> <span class="diffnomatch"><span style="background: #be96c6;"> </span>[~,hostname] = system('hostname');                                              x [~,hostname] = system('hostname');                                              </span> <span><a>  9</a></span></span>
<span class="diffLine" data-left-line="10" data-right-line="10"><a> 10</a> <span class="diffnomatch"><span style="background: #be96c6;"> </span>switch deblank(hostname)                                                        x switch deblank(hostname)                                                        </span> <span><a> 10</a></span></span>
<span class="diffLine" data-left-line="11" data-right-line="11"><a> 11</a> <span class="diffnomatch"><span style="background: #be96c6;">     </span>case '<span style="background: #be96c6;">michele-Precision-7530</span>'                                               x <span style="background: #be96c6;">    </span>case '<span style="background: #be96c6;">fslvm6.localdomain</span>'                                                   </span> <span><a> 11</a></span></span>
<span class="diffLine" data-left-line="12" data-right-line="12"><a> 12</a> <span class="diffnomatch"><span style="background: #be96c6;">         setenv(</span>'<span style="background: #be96c6;">FOLDER</span>'<span style="background: #be96c6;">,'/home/michele/Documents/FastTrack_fullSample')</span>         x <span style="background: #be96c6;">        bpath =</span>'<span style="background: #be96c6;">xxx</span>'<span style="background: #be96c6;">;</span>                                                           </span> <span><a> 12</a></span></span>
<span class="diffLine" data-left-line="13" data-right-line="13"><a> 13</a> <span class="diffnomatch"><span style="background: #be96c6;">         setenv(</span>'<span style="background: #be96c6;">FSLDIR</span>'<span style="background: #be96c6;">,'/usr/local/fsl')</span>                                       x <span style="background: #be96c6;">    case </span>'<span style="background: #be96c6;">xxx</span>'                                                                  </span> <span><a> 13</a></span></span>
<span class="diffLine" data-left-line="14" data-right-line="14"><a> 14</a> <span class="diffnomatch"><span style="background: #be96c6;">         setenv(</span>'<span style="background: #be96c6;">FREESURFER_HOME</span>'<span style="background: #be96c6;">,'/usr/local/freesurfer')</span>                       x <span style="background: #be96c6;">        bpath = </span>'<span style="background: #be96c6;">xxx</span>'<span style="background: #be96c6;">;</span>                                                          </span> <span><a> 14</a></span></span>
<span class="diffLine" data-left-line="15" data-right-line="14"><a> 15</a> <span class="diffnew left">         setenv('SUBJLIST', 'subj_list_39x1.txt') %                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="16" data-right-line="14"><a> 16</a> <span class="diffnew left">         setenv('SGE_TASK_ID','1')                                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="17" data-right-line="14"><a> 17</a> <span class="diffnew left">         setenv('NSLOTS','8')                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="18" data-right-line="15"><a> 18</a> <span class="diffnomatch"><span style="background: #be96c6;"> </span>end                                                                             x end                                                                             </span> <span><a> 15</a></span></span>
</div><span class="nodiff" data-left-line="19" data-right-line="16"><a> 19</a>                                                                                  .                                                                                  <span><a> 16</a></span></span>
<div id="diff1" onclick="select('diff1')"><span class="diffLine" data-left-line="20" data-right-line="17"><a> 20</a> <span class="diffnomatch"><span style="background: #be96c6;">wrk_path</span> = <span style="background: #be96c6;">getenv('FOLDER')</span>;                                                     x <span style="background: #be96c6;">vps</span> = <span style="background: #be96c6;">[3:24 26 28:38 40 41 43:45]</span>;                                              </span> <span><a> 17</a></span></span>
<span class="diffLine" data-left-line="21" data-right-line="17"><a> 21</a> <span class="diffnew left">bpath = fullfile(wrk_path , 'processing');                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="22" data-right-line="18"><a> 22</a>                                                                                  .                                                                                  <span><a> 18</a></span></span>
<span class="nodiff" data-left-line="23" data-right-line="19"><a> 23</a> do_dcm2nii = 0;                                                                  . do_dcm2nii = 0;                                                                  <span><a> 19</a></span></span>
<span class="nodiff" data-left-line="24" data-right-line="20"><a> 24</a> do_t1uniXinv2 = 0; %mp2rage: multiply t1_uni with t1_inv2 for better brain extra . do_t1uniXinv2 = 0; %mp2rage: multiply t1_uni with t1_inv2 for better brain extra <span><a> 20</a></span></span>
                                                                      <span class="diffskip">[10 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="35" data-right-line="31"><a> 35</a> do_fsseg = 0;                                                                    . do_fsseg = 0;                                                                    <span><a> 31</a></span></span>
<span class="nodiff" data-left-line="36" data-right-line="32"><a> 36</a> do_overlap = 0;                                                                  . do_overlap = 0;                                                                  <span><a> 32</a></span></span>
<span class="nodiff" data-left-line="37" data-right-line="33"><a> 37</a>                                                                                  .                                                                                  <span><a> 33</a></span></span>
<div id="diff2" onclick="select('diff2')"><span class="diffLine" data-left-line="38" data-right-line="34"><a> 38</a> <span class="diffnomatch">fsl_path = <span style="background: #be96c6;">getenv(</span>'<span style="background: #be96c6;">FSLDIR</span>'<span style="background: #be96c6;">)</span>;                                                     x fsl_path = '<span style="background: #be96c6;">/usr/local/fsl</span>';                                                    </span> <span><a> 34</a></span></span>
<span class="diffLine" data-left-line="39" data-right-line="35"><a> 39</a> <span class="diffnomatch">fs_path = <span style="background: #be96c6;">getenv(</span>'<span style="background: #be96c6;">FREESURFER_HOME</span>'<span style="background: #be96c6;">)</span>;                                             x fs_path = '<span style="background: #be96c6;">/usr/local/freesurfer</span>';                                              </span> <span><a> 35</a></span></span>
</div><span class="nodiff" data-left-line="40" data-right-line="36"><a> 40</a> fssub_path = fullfile(bpath,'freesurfer_subjects');                              . fssub_path = fullfile(bpath,'freesurfer_subjects');                              <span><a> 36</a></span></span>
<span class="nodiff" data-left-line="41" data-right-line="37"><a> 41</a> dicom_path = fullfile(bpath, 'raw'); %rawdata                                    . dicom_path = fullfile(bpath, 'raw'); %rawdata                                    <span><a> 37</a></span></span>
<span class="nodiff" data-left-line="42" data-right-line="38"><a> 42</a> nii_path = fullfile(bpath, 'nifti');                                             . nii_path = fullfile(bpath, 'nifti');                                             <span><a> 38</a></span></span>
                                                                       <span class="diffskip">[3 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="46" data-right-line="42"><a> 46</a> datasets = {'t1_mp2rage_uni', 't2'};                                             . datasets = {'t1_mp2rage_uni', 't2'};                                             <span><a> 42</a></span></span>
<span class="nodiff" data-left-line="47" data-right-line="43"><a> 47</a> direcs = {'t2w2t1wReg', 'ACPCAlignment', 'BrainExtraction_FNIRTbased', 'xfms', ' . direcs = {'t2w2t1wReg', 'ACPCAlignment', 'BrainExtraction_FNIRTbased', 'xfms', ' <span><a> 43</a></span></span>
<span class="nodiff" data-left-line="48" data-right-line="44"><a> 48</a>                                                                                  .                                                                                  <span><a> 44</a></span></span>
<div id="diff3" onclick="select('diff3')"><span class="diffLine" data-left-line="49" data-right-line="44"><a> 49</a> <span class="diffnew left">% ADDED BY ME %%%%%%%%%                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="50" data-right-line="44"><a> 50</a> <span class="diffnew left">subj_list = getenv('SUBJLIST');                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="51" data-right-line="44"><a> 51</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="52" data-right-line="44"><a> 52</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="53" data-right-line="44"><a> 53</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="54" data-right-line="44"><a> 54</a> <span class="diffnew left">dowloaded_data = fullfile(wrk_path,'data_mri');                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="55" data-right-line="44"><a> 55</a> <span class="diffnew left">n_cores = getenv('NSLOTS');                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="56" data-right-line="44"><a> 56</a> <span class="diffnew left">%%%%%%%%%%%%%%%                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="57" data-right-line="44"><a> 57</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="58" data-right-line="44"><a> 58</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="59" data-right-line="45"><a> 59</a> ref_t1_1mm = fullfile(fsl_path,'data','standard','MNI152_T1_1mm.nii.gz');        . ref_t1_1mm = fullfile(fsl_path,'data','standard','MNI152_T1_1mm.nii.gz');        <span><a> 45</a></span></span>
<span class="nodiff" data-left-line="60" data-right-line="46"><a> 60</a> ref_t1_1mm_brain = fullfile(fsl_path,'data','standard','MNI152_T1_1mm_brain.nii. . ref_t1_1mm_brain = fullfile(fsl_path,'data','standard','MNI152_T1_1mm_brain.nii. <span><a> 46</a></span></span>
<span class="nodiff" data-left-line="61" data-right-line="47"><a> 61</a> ref_t1_1mm_mask = fullfile(fsl_path,'data','standard','MNI152_T1_1mm_brain_mask_ . ref_t1_1mm_mask = fullfile(fsl_path,'data','standard','MNI152_T1_1mm_brain_mask_ <span><a> 47</a></span></span>
                                                                       <span class="diffskip">[8 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="70" data-right-line="56"><a> 70</a>     '--match 9 --match 10 --match 11 --match 12 --match 13 --match 17 --match 18 .     '--match 9 --match 10 --match 11 --match 12 --match 13 --match 17 --match 18 <span><a> 56</a></span></span>
<span class="nodiff" data-left-line="71" data-right-line="57"><a> 71</a>     '--match 1025 --match 2025', '--match 1008','--match 1007','--match 1013 --m .     '--match 1025 --match 2025', '--match 1008','--match 1007','--match 1013 --m <span><a> 57</a></span></span>
<span class="nodiff" data-left-line="72" data-right-line="58"><a> 72</a>                                                                                  .                                                                                  <span><a> 58</a></span></span>
<div id="diff4" onclick="select('diff4')"><span class="diffLine" data-left-line="73" data-right-line="58"><a> 73</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="74" data-right-line="58"><a> 74</a> <span class="diffnew left">% import subj list for parallelization                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="75" data-right-line="58"><a> 75</a> <span class="diffnew left">%subj_list = fullfile(wrk_path,'subj_list_2x1.txt');  %fullfile(wrk_path,'subj_l &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="76" data-right-line="58"><a> 76</a> <span class="diffnew left">fid = fopen(subj_list,'r');                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="77" data-right-line="58"><a> 77</a> <span class="diffnew left">linenum = str2double(getenv('SGE_TASK_ID'));                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="78" data-right-line="58"><a> 78</a> <span class="diffnew left">format_spec = '%d'; % This must reflect the columns in the file e.g.: format_spe &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="79" data-right-line="58"><a> 79</a> <span class="diffnew left">vps = cell2mat(textscan(fid,format_spec, 39,'delimiter','\n', 'headerlines',int3 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="80" data-right-line="58"><a> 80</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="81" data-right-line="58"><a> 81</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="82" data-right-line="59"><a> 82</a> %% do work                                                                       . %% do work                                                                       <span><a> 59</a></span></span>
<span class="nodiff" data-left-line="83" data-right-line="60"><a> 83</a> for n_vp = 1:length(vps)                                                         . for n_vp = 1:length(vps)                                                         <span><a> 60</a></span></span>
<span class="nodiff" data-left-line="84" data-right-line="61"><a> 84</a>     vp_path = fullfile(nii_path,sprintf('VP%03d',vps(n_vp)));                    .     vp_path = fullfile(nii_path,sprintf('VP%03d',vps(n_vp)));                    <span><a> 61</a></span></span>
                                                                      <span class="diffskip">[16 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="101" data-right-line="78"><a>101</a>         mkdir(mnifsxfms_path)                                                    .         mkdir(mnifsxfms_path)                                                    <span><a> 78</a></span></span>
<span class="nodiff" data-left-line="102" data-right-line="79"><a>102</a>         mkdir(mnifs_path)                                                        .         mkdir(mnifs_path)                                                        <span><a> 79</a></span></span>
<span class="nodiff" data-left-line="103" data-right-line="80"><a>103</a>     end                                                                          .     end                                                                          <span><a> 80</a></span></span>
<div id="diff5" onclick="select('diff5')"><span class="diffLine" data-left-line="104" data-right-line="80"><a>104</a> <span class="diffnew left">    %%%% ADDED BY ME %%%%                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="105" data-right-line="80"><a>105</a> <span class="diffnew left">    subj_fold = fullfile(dowloaded_data,sprintf('ID%03d',vps(n_vp)));            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="106" data-right-line="80"><a>106</a> <span class="diffnew left">    struct_data = fullfile(subj_fold,'highres');                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="107" data-right-line="80"><a>107</a> <span class="diffnew left">    t1_uni_defaced = fullfile(struct_data,'t1_mp2rage_sag_p3_iso_uni_defaced.nii &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="108" data-right-line="80"><a>108</a> <span class="diffnew left">    t1_inv_defaced = fullfile(struct_data,'t1_mp2rage_sag_p3_iso_inv2_defaced.ni &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="109" data-right-line="80"><a>109</a> <span class="diffnew left">    t2_defaced = fullfile(struct_data,'t2w_spc_sag_p2_iso0.8_defaced.nii.gz');   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="110" data-right-line="80"><a>110</a> <span class="diffnew left">    % this is to obtain the T2 MNI152 that should be compatible with the script  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="111" data-right-line="80"><a>111</a> <span class="diffnew left"> %   system('flirt -in /usr/local/fsl/data/standard/mni_icbm152_t2_tal_nlin_asym &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="112" data-right-line="80"><a>112</a> <span class="diffnew left"> %   system('flirt -in /usr/local/fsl/data/standard/mni_icbm152_t2_tal_nlin_asym &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="113" data-right-line="80"><a>113</a> <span class="diffnew left">    %%%%%%%%%%%%%%%%%                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="114" data-right-line="80"><a>114</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="115" data-right-line="81"><a>115</a>     for set=1:length(datasets)                                                   .     for set=1:length(datasets)                                                   <span><a> 81</a></span></span>
<span class="nodiff" data-left-line="116" data-right-line="82"><a>116</a>         set_path = fullfile(sess_path,datasets{set});                            .         set_path = fullfile(sess_path,datasets{set});                            <span><a> 82</a></span></span>
<div id="diff6" onclick="select('diff6')"><span class="diffLine" data-left-line="117" data-right-line="82"><a>117</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="118" data-right-line="82"><a>118</a> <span class="diffnew left">        %%%% ADDED BY ME %%%%                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="119" data-right-line="82"><a>119</a> <span class="diffnew left">        if ~exist(set_path,'dir')                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="120" data-right-line="82"><a>120</a> <span class="diffnew left">                mkdir(set_path)                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="121" data-right-line="82"><a>121</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="122" data-right-line="82"><a>122</a> <span class="diffnew left">        if set == 1                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="123" data-right-line="82"><a>123</a> <span class="diffnew left">            t1_uni = fullfile(set_path, 't1_uni.nii.gz');                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="124" data-right-line="82"><a>124</a> <span class="diffnew left">            t1_inv = fullfile(set_path, 't1_inv2.nii.gz');                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="125" data-right-line="82"><a>125</a> <span class="diffnew left">            system(['cp ' t1_uni_defaced ' ' t1_uni ], '-echo');                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="126" data-right-line="82"><a>126</a> <span class="diffnew left">            system(['cp ' t1_inv_defaced ' ' t1_inv ], '-echo');                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="127" data-right-line="82"><a>127</a> <span class="diffnew left">        elseif set == 2                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="128" data-right-line="82"><a>128</a> <span class="diffnew left">            t2 = fullfile(set_path, 'T2.nii.gz');                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="129" data-right-line="82"><a>129</a> <span class="diffnew left">            system(['cp ' t2_defaced ' ' t2 ], '-echo');                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="130" data-right-line="82"><a>130</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="131" data-right-line="82"><a>131</a> <span class="diffnew left">        %%%%%%%%%%%%%%%%%%                                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="132" data-right-line="82"><a>132</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="133" data-right-line="83"><a>133</a>         %dcm2nii                                                                 .         %dcm2nii                                                                 <span><a> 83</a></span></span>
<span class="nodiff" data-left-line="134" data-right-line="84"><a>134</a>         if do_dcm2nii                                                            .         if do_dcm2nii                                                            <span><a> 84</a></span></span>
<span class="nodiff" data-left-line="135" data-right-line="85"><a>135</a>             if ~exist(set_path,'dir')                                            .             if ~exist(set_path,'dir')                                            <span><a> 85</a></span></span>
                                                                      <span class="diffskip">[80 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="216" data-right-line="166"><a>216</a>         acpc_wd = fullfile(set_path,'ACPCAlignment');                            .         acpc_wd = fullfile(set_path,'ACPCAlignment');                            <span><a>166</a></span></span>
<span class="nodiff" data-left-line="217" data-right-line="167"><a>217</a>         acpc_in = fullfile(set_path,sprintf('%sw_reoriented.nii.gz',datasets{set .         acpc_in = fullfile(set_path,sprintf('%sw_reoriented.nii.gz',datasets{set <span><a>167</a></span></span>
<span class="nodiff" data-left-line="218" data-right-line="168"><a>218</a>         if set ==1                                                               .         if set ==1                                                               <span><a>168</a></span></span>
<div id="diff7" onclick="select('diff7')"><span class="diffLine" data-left-line="219" data-right-line="168"><a>219</a> <span class="diffnew left">            acpc_tmp_in = fullfile(set_path,'t1mult_reoriented.nii.gz'); % ADDED &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="220" data-right-line="169"><a>220</a>             acpc_ref = ref_t1_1mm;                                               .             acpc_ref = ref_t1_1mm;                                               <span><a>169</a></span></span>
<span class="nodiff" data-left-line="221" data-right-line="170"><a>221</a>         elseif set ==2                                                           .         elseif set ==2                                                           <span><a>170</a></span></span>
<div id="diff8" onclick="select('diff8')"><span class="diffLine" data-left-line="222" data-right-line="170"><a>222</a> <span class="diffnew left">            acpc_tmp_in = acpc_in; % ADDED BY ME !!!!!                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="223" data-right-line="171"><a>223</a>             acpc_ref = fullfile(bpath,'analysis','MNI_t2w_templates','MNI152_T2_ .             acpc_ref = fullfile(bpath,'analysis','MNI_t2w_templates','MNI152_T2_ <span><a>171</a></span></span>
<span class="nodiff" data-left-line="224" data-right-line="172"><a>224</a>         end                                                                      .         end                                                                      <span><a>172</a></span></span>
<span class="nodiff" data-left-line="225" data-right-line="173"><a>225</a>         acpc_out = fullfile(set_path,sprintf('%sw_acpc.nii.gz',datasets{set}(1:2 .         acpc_out = fullfile(set_path,sprintf('%sw_acpc.nii.gz',datasets{set}(1:2 <span><a>173</a></span></span>
                                                                       <span class="diffskip">[4 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="230" data-right-line="178"><a>230</a>             robustroi=fullfile(acpc_wd,'robustroi.nii.gz');                      .             robustroi=fullfile(acpc_wd,'robustroi.nii.gz');                      <span><a>178</a></span></span>
<span class="nodiff" data-left-line="231" data-right-line="179"><a>231</a>             roi2full = fullfile(acpc_wd,'roi2full.mat');                         .             roi2full = fullfile(acpc_wd,'roi2full.mat');                         <span><a>179</a></span></span>
<span class="nodiff" data-left-line="232" data-right-line="180"><a>232</a>             cropcmd=sprintf('robustfov -i %s -m %s -r %s -b 170 -v',...          .             cropcmd=sprintf('robustfov -i %s -m %s -r %s -b 170 -v',...          <span><a>180</a></span></span>
<div id="diff9" onclick="select('diff9')"><span class="diffLine" data-left-line="233" data-right-line="181"><a>233</a> <span class="diffnomatch">                <span style="background: #be96c6;">acpc_tmp_in</span>, roi2full, robustroi);<span style="background: #be96c6;">  %</span> <span style="background: #be96c6;">MODIFIED BY ME (acpc_in -&gt;</span> x                 <span style="background: #be96c6;">acpc_in</span>, roi2full, robustroi);                                  </span> <span><a>181</a></span></span>
</div><span class="nodiff" data-left-line="234" data-right-line="182"><a>234</a>             fprintf('%s\n',cropcmd)                                              .             fprintf('%s\n',cropcmd)                                              <span><a>182</a></span></span>
<span class="nodiff" data-left-line="235" data-right-line="183"><a>235</a>             system(cropcmd, '-echo');                                            .             system(cropcmd, '-echo');                                            <span><a>183</a></span></span>
<span class="nodiff" data-left-line="236" data-right-line="184"><a>236</a>             full2roi = fullfile(acpc_wd,'full2roi.mat');                         .             full2roi = fullfile(acpc_wd,'full2roi.mat');                         <span><a>184</a></span></span>
                                                                      <span class="diffskip">[33 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="270" data-right-line="218"><a>270</a>                 system(multwarp, '-echo');                                       .                 system(multwarp, '-echo');                                       <span><a>218</a></span></span>
<span class="nodiff" data-left-line="271" data-right-line="219"><a>271</a>             end                                                                  .             end                                                                  <span><a>219</a></span></span>
<span class="nodiff" data-left-line="272" data-right-line="220"><a>272</a>             %QA                                                                  .             %QA                                                                  <span><a>220</a></span></span>
<div id="diff10" onclick="select('diff10')"><span class="diffLine" data-left-line="273" data-right-line="221"><a>273</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>zcmd = sprintf('<span style="background: #be96c6;">fsleyes</span> %s', robustroi);<span style="background: #be96c6;"> % MODIFIED BY ME (fslview</span> x <span style="background: #be96c6;">            </span>zcmd = sprintf('<span style="background: #be96c6;">fslview</span> %s', robustroi);                            </span> <span><a>221</a></span></span>
<span class="diffLine" data-left-line="274" data-right-line="222"><a>274</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>system(zcmd);                                                      x <span style="background: #be96c6;">            </span>system(zcmd);                                                       </span> <span><a>222</a></span></span>
<span class="diffLine" data-left-line="275" data-right-line="223"><a>275</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>zcmd = sprintf('<span style="background: #be96c6;">fsleyes</span> %s %s %s', <span style="background: #be96c6;">acpc_reffr</span>, acpc_final, acpc_ou x <span style="background: #be96c6;">            </span>zcmd = sprintf('<span style="background: #be96c6;">fslview</span> %s %s %s', <span style="background: #be96c6;">acpc_ref</span>, acpc_final, acpc_out); </span> <span><a>223</a></span></span>
<span class="diffLine" data-left-line="276" data-right-line="224"><a>276</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>system(zcmd);                                                      x <span style="background: #be96c6;">            </span>system(zcmd);                                                       </span> <span><a>224</a></span></span>
</div><span class="nodiff" data-left-line="277" data-right-line="225"><a>277</a>         end                                                                      .         end                                                                      <span><a>225</a></span></span>
<span class="nodiff" data-left-line="278" data-right-line="226"><a>278</a>                                                                                  .                                                                                  <span><a>226</a></span></span>
<span class="nodiff" data-left-line="279" data-right-line="227"><a>279</a>         %% initial brain extraction                                              .         %% initial brain extraction                                              <span><a>227</a></span></span>
                                                                      <span class="diffskip">[47 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="327" data-right-line="275"><a>327</a>             fprintf('%s\n',mathcmd)                                              .             fprintf('%s\n',mathcmd)                                              <span><a>275</a></span></span>
<span class="nodiff" data-left-line="328" data-right-line="276"><a>328</a>             system(mathcmd, '-echo');                                            .             system(mathcmd, '-echo');                                            <span><a>276</a></span></span>
<span class="nodiff" data-left-line="329" data-right-line="277"><a>329</a>             %QA                                                                  .             %QA                                                                  <span><a>277</a></span></span>
<div id="diff11" onclick="select('diff11')"><span class="diffLine" data-left-line="330" data-right-line="278"><a>330</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>zcmd = sprintf('<span style="background: #be96c6;">fsleyes</span> %s %s -l Red -t 0.5', acpc_out, be_outbrai x <span style="background: #be96c6;">            </span>zcmd = sprintf('<span style="background: #be96c6;">fslview</span> %s %s -l Red -t 0.5', acpc_out, be_outbrainm</span> <span><a>278</a></span></span>
<span class="diffLine" data-left-line="331" data-right-line="279"><a>331</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>system(zcmd);                                                      x <span style="background: #be96c6;">            </span>system(zcmd);                                                       </span> <span><a>279</a></span></span>
<span class="diffLine" data-left-line="332" data-right-line="280"><a>332</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>zcmd = sprintf('<span style="background: #be96c6;">fsleyes</span> %s %s -t 0.5', be_ref2mm, acpc2MNI_lin);<span style="background: #be96c6;">  </span> x <span style="background: #be96c6;">            </span>zcmd = sprintf('<span style="background: #be96c6;">fslview</span> %s %s -t 0.5', be_ref2mm, acpc2MNI_lin);    </span> <span><a>280</a></span></span>
<span class="diffLine" data-left-line="333" data-right-line="281"><a>333</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>system(zcmd);                                                      x <span style="background: #be96c6;">            </span>system(zcmd);                                                       </span> <span><a>281</a></span></span>
<span class="diffLine" data-left-line="334" data-right-line="282"><a>334</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>zcmd = sprintf('<span style="background: #be96c6;">fsleyes</span> %s %s -t 0.5', acpc_ref, acpc2MNI_nonlin); x <span style="background: #be96c6;">            </span>zcmd = sprintf('<span style="background: #be96c6;">fslview</span> %s %s -t 0.5', acpc_ref, acpc2MNI_nonlin);  </span> <span><a>282</a></span></span>
<span class="diffLine" data-left-line="335" data-right-line="283"><a>335</a> <span class="diffnomatch"><span style="background: #be96c6;">%             </span>system(zcmd);                                                      x <span style="background: #be96c6;">            </span>system(zcmd);                                                       </span> <span><a>283</a></span></span>
</div><span class="nodiff" data-left-line="336" data-right-line="284"><a>336</a>         end                                                                      .         end                                                                      <span><a>284</a></span></span>
<span class="nodiff" data-left-line="337" data-right-line="285"><a>337</a>     end                                                                          .     end                                                                          <span><a>285</a></span></span>
<span class="nodiff" data-left-line="338" data-right-line="286"><a>338</a>                                                                                  .                                                                                  <span><a>286</a></span></span>
                                                                      <span class="diffskip">[43 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="382" data-right-line="330"><a>382</a>         fprintf('%s\n',copy3cmd)                                                 .         fprintf('%s\n',copy3cmd)                                                 <span><a>330</a></span></span>
<span class="nodiff" data-left-line="383" data-right-line="331"><a>383</a>         system(copy3cmd, '-echo');                                               .         system(copy3cmd, '-echo');                                               <span><a>331</a></span></span>
<span class="nodiff" data-left-line="384" data-right-line="332"><a>384</a>         conv3cmd=sprintf('convertwarp --relout --rel -r %s -w %s --postmat=%s -- .         conv3cmd=sprintf('convertwarp --relout --rel -r %s -w %s --postmat=%s -- <span><a>332</a></span></span>
<div id="diff12" onclick="select('diff12')"><span class="diffLine" data-left-line="385" data-right-line="333"><a>385</a> <span class="diffnomatch">            t2_acpc_dc, t1_dc_transform<span style="background: #be96c6;">     </span>, t2w2t1w_mat, t2_dc_transform);     x             t2_acpc_dc, t1_dc_transform, t2w2t1w_mat, t2_dc_transform);         </span> <span><a>333</a></span></span>
</div><span class="nodiff" data-left-line="386" data-right-line="334"><a>386</a>         fprintf('%s\n',conv3cmd)                                                 .         fprintf('%s\n',conv3cmd)                                                 <span><a>334</a></span></span>
<span class="nodiff" data-left-line="387" data-right-line="335"><a>387</a>         system(conv3cmd, '-echo');                                               .         system(conv3cmd, '-echo');                                               <span><a>335</a></span></span>
<div id="diff13" onclick="select('diff13')"><span class="diffLine" data-left-line="388" data-right-line="336"><a>388</a> <span class="diffnomatch">        %QA<span style="background: #be96c6;"> ????????????????</span>                                                     x         %QA                                                                     </span> <span><a>336</a></span></span>
<span class="diffLine" data-left-line="389" data-right-line="337"><a>389</a> <span class="diffnomatch"><span style="background: #be96c6;"> %       </span>if n_vp==1                                                              x <span style="background: #be96c6;">        </span>if n_vp==1                                                              </span> <span><a>337</a></span></span>
<span class="diffLine" data-left-line="390" data-right-line="338"><a>390</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>sl1 = [t1_acpc_dc ' ' t2_acpc_dc];                                  x <span style="background: #be96c6;">            </span>sl1 = [t1_acpc_dc ' ' t2_acpc_dc];                                  </span> <span><a>338</a></span></span>
<span class="diffLine" data-left-line="391" data-right-line="339"><a>391</a> <span class="diffnomatch"><span style="background: #be96c6;"> %       </span>else                                                                    x <span style="background: #be96c6;">        </span>else                                                                    </span> <span><a>339</a></span></span>
<span class="diffLine" data-left-line="392" data-right-line="340"><a>392</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>sl1 = [sl1 ' ' t1_acpc_dc ' ' t2_acpc_dc];                          x <span style="background: #be96c6;">            </span>sl1 = [sl1 ' ' t1_acpc_dc ' ' t2_acpc_dc];                          </span> <span><a>340</a></span></span>
<span class="diffLine" data-left-line="393" data-right-line="341"><a>393</a> <span class="diffnomatch"><span style="background: #be96c6;"> %       </span>end                                                                     x <span style="background: #be96c6;">        </span>end                                                                     </span> <span><a>341</a></span></span>
<span class="diffLine" data-left-line="394" data-right-line="342"><a>394</a> <span class="diffnomatch"><span style="background: #be96c6;"> %       </span>if n_vp==length(vps)                                                    x <span style="background: #be96c6;">        </span>if n_vp==length(vps)                                                    </span> <span><a>342</a></span></span>
<span class="diffLine" data-left-line="395" data-right-line="343"><a>395</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>cd(qa_path);                                                        x <span style="background: #be96c6;">            </span>cd(qa_path);                                                        </span> <span><a>343</a></span></span>
<span class="diffLine" data-left-line="396" data-right-line="344"><a>396</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>slname = 'slicesdir_t22t1reg';                                      x <span style="background: #be96c6;">            </span>slname = 'slicesdir_t22t1reg';                                      </span> <span><a>344</a></span></span>
<span class="diffLine" data-left-line="397" data-right-line="345"><a>397</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>sl = sprintf('slicesdir -o %s', sl1);                               x <span style="background: #be96c6;">            </span>sl = sprintf('slicesdir -o %s', sl1);                               </span> <span><a>345</a></span></span>
<span class="diffLine" data-left-line="398" data-right-line="346"><a>398</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>fprintf('%s\n', sl);                                                x <span style="background: #be96c6;">            </span>fprintf('%s\n', sl);                                                </span> <span><a>346</a></span></span>
<span class="diffLine" data-left-line="399" data-right-line="347"><a>399</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>system(sl, '-echo');                                                x <span style="background: #be96c6;">            </span>system(sl, '-echo');                                                </span> <span><a>347</a></span></span>
<span class="diffLine" data-left-line="400" data-right-line="348"><a>400</a> <span class="diffnomatch"><span style="background: #be96c6;"> %           </span>movefile(fullfile(qa_path,'slicesdir'), fullfile(qa_path,slname));  x <span style="background: #be96c6;">            </span>movefile(fullfile(qa_path,'slicesdir'), fullfile(qa_path,slname));  </span> <span><a>348</a></span></span>
<span class="diffLine" data-left-line="401" data-right-line="349"><a>401</a> <span class="diffnomatch"><span style="background: #be96c6;"> %       </span>end                                                                     x <span style="background: #be96c6;">        </span>end                                                                     </span> <span><a>349</a></span></span>
</div><span class="nodiff" data-left-line="402" data-right-line="350"><a>402</a>     end                                                                          .     end                                                                          <span><a>350</a></span></span>
<span class="nodiff" data-left-line="403" data-right-line="351"><a>403</a>                                                                                  .                                                                                  <span><a>351</a></span></span>
<span class="nodiff" data-left-line="404" data-right-line="352"><a>404</a>     %% bias field correction based on sqrt T1w*T2w                               .     %% bias field correction based on sqrt T1w*T2w                               <span><a>352</a></span></span>
                                                                      <span class="diffskip">[91 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="496" data-right-line="444"><a>496</a>         fprintf('%s\n',bfc4cmd)                                                  .         fprintf('%s\n',bfc4cmd)                                                  <span><a>444</a></span></span>
<span class="nodiff" data-left-line="497" data-right-line="445"><a>497</a>         system(bfc4cmd,'-echo');                                                 .         system(bfc4cmd,'-echo');                                                 <span><a>445</a></span></span>
<span class="nodiff" data-left-line="498" data-right-line="446"><a>498</a>         %QA                                                                      .         %QA                                                                      <span><a>446</a></span></span>
<div id="diff14" onclick="select('diff14')"><span class="diffLine" data-left-line="499" data-right-line="447"><a>499</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        if n_vp == 1                                                            x         if n_vp == 1                                                            </span> <span><a>447</a></span></span>
<span class="diffLine" data-left-line="500" data-right-line="448"><a>500</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            sl1 = [t1_acpc_dc_brain ' ' t1_acpc_dc_rest_brain];                 x             sl1 = [t1_acpc_dc_brain ' ' t1_acpc_dc_rest_brain];                 </span> <span><a>448</a></span></span>
<span class="diffLine" data-left-line="501" data-right-line="449"><a>501</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            sl2 = [t2_acpc_dc ' ' t2_acpc_dc_rest];                             x             sl2 = [t2_acpc_dc ' ' t2_acpc_dc_rest];                             </span> <span><a>449</a></span></span>
<span class="diffLine" data-left-line="502" data-right-line="450"><a>502</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        else                                                                    x         else                                                                    </span> <span><a>450</a></span></span>
<span class="diffLine" data-left-line="503" data-right-line="451"><a>503</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            sl1 = [sl1 ' ' t1_acpc_dc_brain ' ' t1_acpc_dc_rest_brain];         x             sl1 = [sl1 ' ' t1_acpc_dc_brain ' ' t1_acpc_dc_rest_brain];         </span> <span><a>451</a></span></span>
<span class="diffLine" data-left-line="504" data-right-line="452"><a>504</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            sl2 = [sl2 ' ' t2_acpc_dc ' ' t2_acpc_dc_rest];                     x             sl2 = [sl2 ' ' t2_acpc_dc ' ' t2_acpc_dc_rest];                     </span> <span><a>452</a></span></span>
<span class="diffLine" data-left-line="505" data-right-line="453"><a>505</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        end                                                                     x         end                                                                     </span> <span><a>453</a></span></span>
<span class="diffLine" data-left-line="506" data-right-line="454"><a>506</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        if n_vp==length(vps)                                                    x         if n_vp==length(vps)                                                    </span> <span><a>454</a></span></span>
<span class="diffLine" data-left-line="507" data-right-line="455"><a>507</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            cd(qa_path);                                                        x             cd(qa_path);                                                        </span> <span><a>455</a></span></span>
<span class="diffLine" data-left-line="508" data-right-line="456"><a>508</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            slname = {'slicesdir_t1_bfc', 'slicesdir_t2_bfc'};                  x             slname = {'slicesdir_t1_bfc', 'slicesdir_t2_bfc'};                  </span> <span><a>456</a></span></span>
<span class="diffLine" data-left-line="509" data-right-line="457"><a>509</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            for slx = 1:length(slname)                                          x             for slx = 1:length(slname)                                          </span> <span><a>457</a></span></span>
<span class="diffLine" data-left-line="510" data-right-line="458"><a>510</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                if slx ==1                                                      x                 if slx ==1                                                      </span> <span><a>458</a></span></span>
<span class="diffLine" data-left-line="511" data-right-line="459"><a>511</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                    sl = sprintf('slicesdir %s', sl1);                          x                     sl = sprintf('slicesdir %s', sl1);                          </span> <span><a>459</a></span></span>
<span class="diffLine" data-left-line="512" data-right-line="460"><a>512</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                else                                                            x                 else                                                            </span> <span><a>460</a></span></span>
<span class="diffLine" data-left-line="513" data-right-line="461"><a>513</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                    sl = sprintf('slicesdir %s', sl2);                          x                     sl = sprintf('slicesdir %s', sl2);                          </span> <span><a>461</a></span></span>
<span class="diffLine" data-left-line="514" data-right-line="462"><a>514</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                end                                                             x                 end                                                             </span> <span><a>462</a></span></span>
<span class="diffLine" data-left-line="515" data-right-line="463"><a>515</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                system(sl, '-echo');                                            x                 system(sl, '-echo');                                            </span> <span><a>463</a></span></span>
<span class="diffLine" data-left-line="516" data-right-line="464"><a>516</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>                movefile(fullfile(qa_path,'slicesdir'), fullfile(qa_path,slname x                 movefile(fullfile(qa_path,'slicesdir'), fullfile(qa_path,slname{</span> <span><a>464</a></span></span>
<span class="diffLine" data-left-line="517" data-right-line="465"><a>517</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>            end                                                                 x             end                                                                 </span> <span><a>465</a></span></span>
<span class="diffLine" data-left-line="518" data-right-line="466"><a>518</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        end                                                                     x         end                                                                     </span> <span><a>466</a></span></span>
</div><span class="nodiff" data-left-line="519" data-right-line="467"><a>519</a>     end                                                                          .     end                                                                          <span><a>467</a></span></span>
<span class="nodiff" data-left-line="520" data-right-line="468"><a>520</a>                                                                                  .                                                                                  <span><a>468</a></span></span>
<span class="nodiff" data-left-line="521" data-right-line="469"><a>521</a>     %% reg to MNI                                                                .     %% reg to MNI                                                                <span><a>469</a></span></span>
                                                                      <span class="diffskip">[24 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="546" data-right-line="494"><a>546</a>             t1_acpc_dc_rest, ref_t1_2mm, acpc2mnilin, ref_t1_2mm_mask, acpc_dc2s .             t1_acpc_dc_rest, ref_t1_2mm, acpc2mnilin, ref_t1_2mm_mask, acpc_dc2s <span><a>494</a></span></span>
<span class="nodiff" data-left-line="547" data-right-line="495"><a>547</a>         fprintf('%s\n',mnireg2cmd)                                               .         fprintf('%s\n',mnireg2cmd)                                               <span><a>495</a></span></span>
<span class="nodiff" data-left-line="548" data-right-line="496"><a>548</a>         system(mnireg2cmd,'-echo');                                              .         system(mnireg2cmd,'-echo');                                              <span><a>496</a></span></span>
<div id="diff15" onclick="select('diff15')"><span class="diffLine" data-left-line="549" data-right-line="497"><a>549</a> <span class="diffnomatch"><span style="background: #be96c6;">         </span>inv2cmd=sprintf('invwarp -w %s -o %s -r %s -v', ...                     x <span style="background: #be96c6;">        </span>inv2cmd=sprintf('invwarp -w %s -o %s -r %s -v', ...                     </span> <span><a>497</a></span></span>
</div><span class="nodiff" data-left-line="550" data-right-line="498"><a>550</a>             acpc_dc2std, std2acpc_dc, ref_t1_2mm);                               .             acpc_dc2std, std2acpc_dc, ref_t1_2mm);                               <span><a>498</a></span></span>
<span class="nodiff" data-left-line="551" data-right-line="499"><a>551</a>         fprintf('%s\n',inv2cmd)                                                  .         fprintf('%s\n',inv2cmd)                                                  <span><a>499</a></span></span>
<span class="nodiff" data-left-line="552" data-right-line="500"><a>552</a>         system(inv2cmd,'-echo');                                                 .         system(inv2cmd,'-echo');                                                 <span><a>500</a></span></span>
                                                                      <span class="diffskip">[33 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="586" data-right-line="534"><a>586</a>         system(mnimask2cmd,'-echo');                                             .         system(mnimask2cmd,'-echo');                                             <span><a>534</a></span></span>
<span class="nodiff" data-left-line="587" data-right-line="535"><a>587</a>                                                                                  .                                                                                  <span><a>535</a></span></span>
<span class="nodiff" data-left-line="588" data-right-line="536"><a>588</a>         %QA                                                                      .         %QA                                                                      <span><a>536</a></span></span>
<div id="diff16" onclick="select('diff16')"><span class="diffLine" data-left-line="589" data-right-line="537"><a>589</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        zcmd = sprintf('fslview %s %s', ref_t1_1mm, mni_t1_rest);               x         zcmd = sprintf('fslview %s %s', ref_t1_1mm, mni_t1_rest);               </span> <span><a>537</a></span></span>
<span class="diffLine" data-left-line="590" data-right-line="538"><a>590</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        system(zcmd);                                                           x         system(zcmd);                                                           </span> <span><a>538</a></span></span>
<span class="diffLine" data-left-line="591" data-right-line="539"><a>591</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        zcmd = sprintf('fslview %s %s', ref_t1_1mm, mni_t2_rest);               x         zcmd = sprintf('fslview %s %s', ref_t1_1mm, mni_t2_rest);               </span> <span><a>539</a></span></span>
<span class="diffLine" data-left-line="592" data-right-line="540"><a>592</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>        system(zcmd);                                                           x         system(zcmd);                                                           </span> <span><a>540</a></span></span>
</div><span class="nodiff" data-left-line="593" data-right-line="541"><a>593</a>     end                                                                          .     end                                                                          <span><a>541</a></span></span>
<span class="nodiff" data-left-line="594" data-right-line="542"><a>594</a>                                                                                  .                                                                                  <span><a>542</a></span></span>
<span class="nodiff" data-left-line="595" data-right-line="543"><a>595</a>     %% freesurfer                                                                .     %% freesurfer                                                                <span><a>543</a></span></span>
                                                                       <span class="diffskip">[5 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="601" data-right-line="549"><a>601</a>     fs_nu = fullfile(fsmri_path,'nu.mgz');                                       .     fs_nu = fullfile(fsmri_path,'nu.mgz');                                       <span><a>549</a></span></span>
<span class="nodiff" data-left-line="602" data-right-line="550"><a>602</a>     fs_t1 = fullfile(fsmri_path,'T1.mgz');                                       .     fs_t1 = fullfile(fsmri_path,'T1.mgz');                                       <span><a>550</a></span></span>
<span class="nodiff" data-left-line="603" data-right-line="551"><a>603</a>     fs_talaiwskull = fullfile(fsmri_path,'transforms','talairach_with_skull.lta' .     fs_talaiwskull = fullfile(fsmri_path,'transforms','talairach_with_skull.lta' <span><a>551</a></span></span>
<div id="diff17" onclick="select('diff17')"><span class="diffLine" data-left-line="604" data-right-line="551"><a>604</a> <span class="diffnew left">    % MODIFIED BY ME  !!!!!!!                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="605" data-right-line="551"><a>605</a> <span class="diffnew left">    %{                                                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="606" data-right-line="552"><a>606</a>     fs_gca1 = fullfile(fs_path,'average','RB_all_2008-03-26.gca');               .     fs_gca1 = fullfile(fs_path,'average','RB_all_2008-03-26.gca');               <span><a>552</a></span></span>
<span class="nodiff" data-left-line="607" data-right-line="553"><a>607</a>     fs_gca2 = fullfile(fs_path,'average','RB_all_withskull_2008-03-26.gca');     .     fs_gca2 = fullfile(fs_path,'average','RB_all_withskull_2008-03-26.gca');     <span><a>553</a></span></span>
<div id="diff18" onclick="select('diff18')"><span class="diffLine" data-left-line="608" data-right-line="554"><a>608</a> <span class="diffnomatch">    <span style="background: #be96c6;">%}</span>                                                                           x     <span style="background: #be96c6;">if do_freesurfer1</span>                                                           </span> <span><a>554</a></span></span>
<span class="diffLine" data-left-line="609" data-right-line="554"><a>609</a> <span class="diffnew left">    fs_gca1 = fullfile(fs_path,'average','RB_all_2016-05-10.vc700.gca');         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="610" data-right-line="554"><a>610</a> <span class="diffnew left">    fs_gca2 = fullfile(fs_path,'average','RB_all_withskull_2016-05-10.vc700.gca' &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="611" data-right-line="554"><a>611</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="612" data-right-line="554"><a>612</a> <span class="diffnew left">    % ADDED BY ME !!!!!!!!!!!! I'm trying to export the SUBJDIR path but it      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="613" data-right-line="554"><a>613</a> <span class="diffnew left">    subjDir_path = fullfile(bpath,'freesurfer_subjects');                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="614" data-right-line="554"><a>614</a> <span class="diffnew left">    system(['mkdir -p ' subjDir_path], '-echo');                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="615" data-right-line="554"><a>615</a> <span class="diffnew left">    setenv('SUBJECTS_DIR',subjDir_path)                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="616" data-right-line="554"><a>616</a> <span class="diffnew left">    system('echo $SUBJECTS_DIR');                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="617" data-right-line="554"><a>617</a> <span class="diffnew left">    % ADDED BY ME !!!!!!!!!!!!                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="618" data-right-line="554"><a>618</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="619" data-right-line="554"><a>619</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="620" data-right-line="554"><a>620</a> <span class="diffnew left">    if do_freesurfer1 % It takes ~200 seconds no parallelization                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="621" data-right-line="555"><a>621</a>         zcmd = sprintf('recon-all -i %s -subjid %s -motioncor -talairach -nuinte .         zcmd = sprintf('recon-all -i %s -subjid %s -motioncor -talairach -nuinte <span><a>555</a></span></span>
<span class="nodiff" data-left-line="622" data-right-line="556"><a>622</a>             t1_acpc_dc_rest, fs_subjID);                                         .             t1_acpc_dc_rest, fs_subjID);                                         <span><a>556</a></span></span>
<span class="nodiff" data-left-line="623" data-right-line="557"><a>623</a>         fprintf('%s\n',zcmd);                                                    .         fprintf('%s\n',zcmd);                                                    <span><a>557</a></span></span>
<span class="nodiff" data-left-line="624" data-right-line="558"><a>624</a>         system(zcmd);                                                            .         system(zcmd);                                                            <span><a>558</a></span></span>
<div id="diff19" onclick="select('diff19')"><span class="diffLine" data-left-line="624" data-right-line="559"><span class="diffsoft">  -</span> <span class="diffold">                                                                                </span><span class="diffnew right"> &gt;                                                                                 </span> <span><a>559</a></span></span>
</div><span class="nodiff" data-left-line="625" data-right-line="560"><a>625</a>         %%if talairach transform fails: register t1 to mni manually              .         %%if talairach transform fails: register t1 to mni manually              <span><a>560</a></span></span>
<span class="nodiff" data-left-line="626" data-right-line="561"><a>626</a> %         zcmd=sprintf('recon-all -i %s -subjid %s -motioncor -talairach -notalc . %         zcmd=sprintf('recon-all -i %s -subjid %s -motioncor -talairach -notalc <span><a>561</a></span></span>
<span class="nodiff" data-left-line="627" data-right-line="562"><a>627</a> %             t1_acpc_dc_rest, fs_subjID);                                       . %             t1_acpc_dc_rest, fs_subjID);                                       <span><a>562</a></span></span>
                                                                      <span class="diffskip">[16 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="644" data-right-line="579"><a>644</a> %         system(zcmd);                                                          . %         system(zcmd);                                                          <span><a>579</a></span></span>
<span class="nodiff" data-left-line="645" data-right-line="580"><a>645</a>     end                                                                          .     end                                                                          <span><a>580</a></span></span>
<span class="nodiff" data-left-line="646" data-right-line="581"><a>646</a>                                                                                  .                                                                                  <span><a>581</a></span></span>
<div id="diff20" onclick="select('diff20')"><span class="diffLine" data-left-line="647" data-right-line="582"><a>647</a> <span class="diffnomatch">    if do_prefreesurfer2<span style="background: #be96c6;"> % It takes ~ 400 seconds</span>                                x     if do_prefreesurfer2                                                        </span> <span><a>582</a></span></span>
</div><span class="nodiff" data-left-line="648" data-right-line="583"><a>648</a>         %generate brain mask                                                     .         %generate brain mask                                                     <span><a>583</a></span></span>
<div id="diff21" onclick="select('diff21')"><span class="diffLine" data-left-line="649" data-right-line="583"><a>649</a> <span class="diffnew left">        tic                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="650" data-right-line="584"><a>650</a>         zcmd=sprintf('mri_convert %s %s --conform', ...                          .         zcmd=sprintf('mri_convert %s %s --conform', ...                          <span><a>584</a></span></span>
<span class="nodiff" data-left-line="651" data-right-line="585"><a>651</a>             t1_acpc_dc_rest_brain, fs_brainmask); %--conform to 1mm voxel size i .             t1_acpc_dc_rest_brain, fs_brainmask); %--conform to 1mm voxel size i <span><a>585</a></span></span>
<span class="nodiff" data-left-line="652" data-right-line="586"><a>652</a>         fprintf('%s\n',zcmd)                                                     .         fprintf('%s\n',zcmd)                                                     <span><a>586</a></span></span>
<span class="nodiff" data-left-line="653" data-right-line="587"><a>653</a>         system(zcmd);                                                            .         system(zcmd);                                                            <span><a>587</a></span></span>
<span class="nodiff" data-left-line="654" data-right-line="588"><a>654</a>                                                                                  .                                                                                  <span><a>588</a></span></span>
<span class="nodiff" data-left-line="655" data-right-line="589"><a>655</a>         zcmd=sprintf('mri_em_register -mask %s %s %s %s', ...                    .         zcmd=sprintf('mri_em_register -mask %s %s %s %s', ...                    <span><a>589</a></span></span>
<div id="diff22" onclick="select('diff22')"><span class="diffLine" data-left-line="656" data-right-line="590"><a>656</a> <span class="diffnomatch">            fs_brainmask, fs_nu, fs_gca1, fs_talaiwskull);<span style="background: #be96c6;"> % (added comment) cre</span> x             fs_brainmask, fs_nu, fs_gca1, fs_talaiwskull);                      </span> <span><a>590</a></span></span>
</div><span class="nodiff" data-left-line="657" data-right-line="591"><a>657</a>         fprintf('%s\n',zcmd)                                                     .         fprintf('%s\n',zcmd)                                                     <span><a>591</a></span></span>
<span class="nodiff" data-left-line="658" data-right-line="592"><a>658</a>         system(zcmd);                                                            .         system(zcmd);                                                            <span><a>592</a></span></span>
<span class="nodiff" data-left-line="659" data-right-line="593"><a>659</a>                                                                                  .                                                                                  <span><a>593</a></span></span>
<span class="nodiff" data-left-line="660" data-right-line="594"><a>660</a>         zcmd=sprintf('mri_watershed -T1 -brain_atlas %s %s %s %s', ...           .         zcmd=sprintf('mri_watershed -T1 -brain_atlas %s %s %s %s', ...           <span><a>594</a></span></span>
<div id="diff23" onclick="select('diff23')"><span class="diffLine" data-left-line="661" data-right-line="595"><a>661</a> <span class="diffnomatch">            fs_gca2, fs_talaiwskull, fs_t1, fs_brainmaskauto);<span style="background: #be96c6;"> % (added comment)</span> x             fs_gca2, fs_talaiwskull, fs_t1, fs_brainmaskauto);                  </span> <span><a>595</a></span></span>
</div><span class="nodiff" data-left-line="662" data-right-line="596"><a>662</a>         fprintf('%s\n',zcmd)                                                     .         fprintf('%s\n',zcmd)                                                     <span><a>596</a></span></span>
<span class="nodiff" data-left-line="663" data-right-line="597"><a>663</a>         system(zcmd);                                                            .         system(zcmd);                                                            <span><a>597</a></span></span>
<div id="diff24" onclick="select('diff24')"><span class="diffLine" data-left-line="664" data-right-line="598"><a>664</a> <span class="diffnomatch">        <span style="background: #be96c6;">toc</span>                                                                      x                                                                                 </span> <span><a>598</a></span></span>
</div><span class="nodiff" data-left-line="665" data-right-line="599"><a>665</a>         %%if watershed error: T1 does not have enough wm values of 110, then pro .         %%if watershed error: T1 does not have enough wm values of 110, then pro <span><a>599</a></span></span>
<span class="nodiff" data-left-line="666" data-right-line="600"><a>666</a>         %%-- add control points to nu.mgz and rerun normalization and watershed  .         %%-- add control points to nu.mgz and rerun normalization and watershed  <span><a>600</a></span></span>
<span class="nodiff" data-left-line="667" data-right-line="601"><a>667</a> %         controldir = fullfile(fssub_path,fs_subjID,'tmp');                     . %         controldir = fullfile(fssub_path,fs_subjID,'tmp');                     <span><a>601</a></span></span>
                                                                      <span class="diffskip">[18 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="686" data-right-line="620"><a>686</a> %         fprintf('%s\n',zcmd)                                                   . %         fprintf('%s\n',zcmd)                                                   <span><a>620</a></span></span>
<span class="nodiff" data-left-line="687" data-right-line="621"><a>687</a> %         system(zcmd);                                                          . %         system(zcmd);                                                          <span><a>621</a></span></span>
<span class="nodiff" data-left-line="688" data-right-line="622"><a>688</a>                                                                                  .                                                                                  <span><a>622</a></span></span>
<div id="diff25" onclick="select('diff25')"><span class="diffLine" data-left-line="689" data-right-line="622"><a>689</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="690" data-right-line="622"><a>690</a> <span class="diffnew left">% I UNCOMMENTED THIS BECAUSE THERE WHERE DURA LEFT IN THE BRAIN MASK AND         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="691" data-right-line="622"><a>691</a> <span class="diffnew left">% THE SENCOND STEP OF FREESURFER WAS FAILING (IT SEEMS TO WORK NOW)              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="692" data-right-line="623"><a>692</a>         %%then if still parts of dura left can try                               .         %%then if still parts of dura left can try                               <span><a>623</a></span></span>
<div id="diff26" onclick="select('diff26')"><span class="diffLine" data-left-line="693" data-right-line="624"><a>693</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>%option 1 gcut                                                           x %<span style="background: #be96c6;">         %</span>option 1 gcut                                                        </span> <span><a>624</a></span></span>
<span class="diffLine" data-left-line="694" data-right-line="625"><a>694</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>%old brainmask file is saved in subj/trash                               x %<span style="background: #be96c6;">         %</span>old brainmask file is saved in subj/trash                            </span> <span><a>625</a></span></span>
<span class="diffLine" data-left-line="695" data-right-line="625"><a>695</a> <span class="diffnew left">        tic                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="696" data-right-line="626"><a>696</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>zcmd=sprintf('recon-all -skullstrip -clean-bm -gcut -subjid %s', ...     x <span style="background: #be96c6;">%         </span>zcmd=sprintf('recon-all -skullstrip -clean-bm -gcut -subjid %s', ...  </span> <span><a>626</a></span></span>
<span class="diffLine" data-left-line="697" data-right-line="627"><a>697</a> <span class="diffnomatch"><span style="background: #be96c6;">            </span>fs_subjID);                                                          x <span style="background: #be96c6;">%             </span>fs_subjID);                                                       </span> <span><a>627</a></span></span>
<span class="diffLine" data-left-line="698" data-right-line="628"><a>698</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>fprintf('%s\n',zcmd)                                                     x <span style="background: #be96c6;">%         </span>fprintf('%s\n',zcmd)                                                  </span> <span><a>628</a></span></span>
<span class="diffLine" data-left-line="699" data-right-line="629"><a>699</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>system(zcmd);                                                            x <span style="background: #be96c6;">%         </span>system(zcmd);                                                         </span> <span><a>629</a></span></span>
<span class="diffLine" data-left-line="700" data-right-line="630"><a>700</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>%and check                                                               x %<span style="background: #be96c6;">         %</span>and check                                                            </span> <span><a>630</a></span></span>
<span class="diffLine" data-left-line="701" data-right-line="631"><a>701</a> <span class="diffnomatch">%<span style="background: #be96c6;">        </span>zcmd=sprintf('<span style="background: #be96c6;">fsleyes</span> -v %s $SUBJECTS_DIR/%s/mri/brainmask.gcuts.mgz:co x %<span style="background: #be96c6;">         </span>zcmd=sprintf('<span style="background: #be96c6;">freeview</span> -v %s $SUBJECTS_DIR/%s/mri/brainmask.gcuts.mgz:</span> <span><a>631</a></span></span>
<span class="diffLine" data-left-line="702" data-right-line="632"><a>702</a> <span class="diffnomatch">%<span style="background: #be96c6;">            </span>old_brainmaskauto, fs_subjID);                                      x %<span style="background: #be96c6;">             </span>old_brainmaskauto, fs_subjID);                                    </span> <span><a>632</a></span></span>
<span class="diffLine" data-left-line="703" data-right-line="633"><a>703</a> <span class="diffnomatch">%<span style="background: #be96c6;">        </span>system(zcmd);                                                           x %<span style="background: #be96c6;">         </span>system(zcmd);                                                         </span> <span><a>633</a></span></span>
<span class="diffLine" data-left-line="704" data-right-line="634"><a>704</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>%option 2 if gcut fails then lower preflooding height of watershed       x %<span style="background: #be96c6;">         %</span>option 2 if gcut fails then lower preflooding height of watershed    </span> <span><a>634</a></span></span>
<span class="diffLine" data-left-line="705" data-right-line="635"><a>705</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>%(default 25) to 15                                                      x %<span style="background: #be96c6;">         %</span>(default 25) to 15                                                   </span> <span><a>635</a></span></span>
</div><span class="nodiff" data-left-line="706" data-right-line="636"><a>706</a> %         zcmd=sprintf('recon-all -skullstrip -wsthresh 15 -clean-bm -subjid %s' . %         zcmd=sprintf('recon-all -skullstrip -wsthresh 15 -clean-bm -subjid %s' <span><a>636</a></span></span>
<span class="nodiff" data-left-line="707" data-right-line="637"><a>707</a> %             fs_subjID);                                                        . %             fs_subjID);                                                        <span><a>637</a></span></span>
<span class="nodiff" data-left-line="708" data-right-line="638"><a>708</a> %         fprintf('%s\n',zcmd)                                                   . %         fprintf('%s\n',zcmd)                                                   <span><a>638</a></span></span>
<span class="nodiff" data-left-line="709" data-right-line="639"><a>709</a> %         system(zcmd);                                                          . %         system(zcmd);                                                          <span><a>639</a></span></span>
<div id="diff27" onclick="select('diff27')"><span class="diffLine" data-left-line="710" data-right-line="640"><a>710</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>%and check                                                               x %<span style="background: #be96c6;">         %</span>and check                                                            </span> <span><a>640</a></span></span>
<span class="diffLine" data-left-line="711" data-right-line="641"><a>711</a> <span class="diffnomatch">%<span style="background: #be96c6;">        </span>zcmd=sprintf('freeview -v %s $SUBJECTS_DIR/%s/mri/brainmask.mgz:colorma x %<span style="background: #be96c6;">         </span>zcmd=sprintf('freeview -v %s $SUBJECTS_DIR/%s/mri/brainmask.mgz:colorm</span> <span><a>641</a></span></span>
<span class="diffLine" data-left-line="712" data-right-line="642"><a>712</a> <span class="diffnomatch">%<span style="background: #be96c6;">        </span>system(zcmd);                                                           x %<span style="background: #be96c6;">         </span>system(zcmd);                                                         </span> <span><a>642</a></span></span>
<span class="diffLine" data-left-line="713" data-right-line="642"><a>713</a> <span class="diffnew left">        toc                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="714" data-right-line="642"><a>714</a> <span class="diffnew left">        % ADDED BY ME !!!                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="715" data-right-line="642"><a>715</a> <span class="diffnew left">%         % if the segmentation is too aggressive use the following command      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="716" data-right-line="642"><a>716</a> <span class="diffnew left">%         % to manually adjust the brain mask (see also                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="717" data-right-line="642"><a>717</a> <span class="diffnew left">%         % https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/SkullStripFix_t &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="718" data-right-line="642"><a>718</a> <span class="diffnew left">%         zcmd=sprintf('tkmedit %s brainmask.mgz -aux T1.mgz', ...               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="719" data-right-line="642"><a>719</a> <span class="diffnew left">%             fs_subjID);                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="720" data-right-line="642"><a>720</a> <span class="diffnew left">%         fprintf('%s\n',zcmd)                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="721" data-right-line="642"><a>721</a> <span class="diffnew left">%         system(zcmd);                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="722" data-right-line="642"><a>722</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="723" data-right-line="642"><a>723</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="724" data-right-line="643"><a>724</a>     end                                                                          .     end                                                                          <span><a>643</a></span></span>
<span class="nodiff" data-left-line="725" data-right-line="644"><a>725</a>                                                                                  .                                                                                  <span><a>644</a></span></span>
<div id="diff28" onclick="select('diff28')"><span class="diffLine" data-left-line="726" data-right-line="645"><a>726</a> <span class="diffnomatch"><span style="background: #be96c6;">   </span>if do_freesurfer2                                                             x <span style="background: #be96c6;">    </span>if do_freesurfer2                                                           </span> <span><a>645</a></span></span>
<span class="diffLine" data-left-line="727" data-right-line="646"><a>727</a> <span class="diffnomatch"><span style="background: #be96c6;">       </span>recon2cmd=sprintf('recon-all -subjid %s -autorecon2<span style="background: #be96c6;"> -parallel -openmp %s</span>' x <span style="background: #be96c6;">        </span>recon2cmd=sprintf('recon-all -subjid %s -autorecon2', ...               </span> <span><a>646</a></span></span>
<span class="diffLine" data-left-line="728" data-right-line="647"><a>728</a> <span class="diffnomatch"><span style="background: #be96c6;">           </span>fs_subjID<span style="background: #be96c6;">, n_cores</span>);                                                  x <span style="background: #be96c6;">            </span>fs_subjID);                                                         </span> <span><a>647</a></span></span>
<span class="diffLine" data-left-line="729" data-right-line="648"><a>729</a> <span class="diffnomatch"><span style="background: #be96c6;">       </span>fprintf('%s\n',recon2cmd);                                                x <span style="background: #be96c6;">        </span>fprintf('%s\n',recon2cmd);                                              </span> <span><a>648</a></span></span>
<span class="diffLine" data-left-line="730" data-right-line="649"><a>730</a> <span class="diffnomatch"><span style="background: #be96c6;">       </span>system(recon2cmd);                                                        x <span style="background: #be96c6;">        </span>system(recon2cmd);                                                      </span> <span><a>649</a></span></span>
<span class="diffLine" data-left-line="731" data-right-line="650"><a>731</a> <span class="diffnomatch">        %if big defects during fix topology check unfixed surfaces to see if sku x         %<span style="background: #be96c6;">%</span>if big defects during fix topology check unfixed surfaces to see if sk</span> <span><a>650</a></span></span>
</div><span class="nodiff" data-left-line="732" data-right-line="651"><a>732</a> %         hemi = 'xx';                                                           . %         hemi = 'xx';                                                           <span><a>651</a></span></span>
<span class="nodiff" data-left-line="733" data-right-line="652"><a>733</a> %         zcmd=sprintf('freeview -v $SUBJECTS_DIR/%s/mri/T1.mgz -f $SUBJECTS_DIR . %         zcmd=sprintf('freeview -v $SUBJECTS_DIR/%s/mri/T1.mgz -f $SUBJECTS_DIR <span><a>652</a></span></span>
<span class="nodiff" data-left-line="734" data-right-line="653"><a>734</a> %            fs_subjID, fs_subjID);                                              . %            fs_subjID, fs_subjID);                                              <span><a>653</a></span></span>
<span class="nodiff" data-left-line="735" data-right-line="654"><a>735</a> %         system(zcmd);                                                          . %         system(zcmd);                                                          <span><a>654</a></span></span>
<div id="diff29" onclick="select('diff29')"><span class="diffLine" data-left-line="736" data-right-line="655"><a>736</a> <span class="diffnomatch"><span style="background: #be96c6;">   </span>end                                                                           x <span style="background: #be96c6;">    </span>end                                                                         </span> <span><a>655</a></span></span>
</div><span class="nodiff" data-left-line="737" data-right-line="656"><a>737</a>                                                                                  .                                                                                  <span><a>656</a></span></span>
<div id="diff30" onclick="select('diff30')"><span class="diffLine" data-left-line="738" data-right-line="657"><a>738</a> <span class="diffnomatch"><span style="background: #be96c6;">   </span>if do_freesurfer3                                                             x <span style="background: #be96c6;">    </span>if do_freesurfer3                                                           </span> <span><a>657</a></span></span>
<span class="diffLine" data-left-line="739" data-right-line="658"><a>739</a> <span class="diffnomatch"><span style="background: #be96c6;">       </span>recon3cmd=sprintf('recon-all -subjid %s -T2 %s -T2pial -autorecon3<span style="background: #be96c6;"> -paral</span> x <span style="background: #be96c6;">        </span>recon3cmd=sprintf('recon-all -subjid %s -T2 %s -T2pial -autorecon3',... </span> <span><a>658</a></span></span>
<span class="diffLine" data-left-line="740" data-right-line="659"><a>740</a> <span class="diffnomatch"><span style="background: #be96c6;">           </span>fs_subjID, t2_acpc_dc_rest<span style="background: #be96c6;">, n_cores</span>);                                 x <span style="background: #be96c6;">            </span>fs_subjID, t2_acpc_dc_rest);                                        </span> <span><a>659</a></span></span>
<span class="diffLine" data-left-line="741" data-right-line="660"><a>741</a> <span class="diffnomatch"><span style="background: #be96c6;">       </span>fprintf('%s\n',recon3cmd);                                                x <span style="background: #be96c6;">        </span>fprintf('%s\n',recon3cmd);                                              </span> <span><a>660</a></span></span>
<span class="diffLine" data-left-line="742" data-right-line="661"><a>742</a> <span class="diffnomatch"><span style="background: #be96c6;">       </span>system(recon3cmd);                                                        x <span style="background: #be96c6;">        </span>system(recon3cmd);                                                      </span> <span><a>661</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="662"><a>743</a> <span class="diffnomatch"><span style="background: #be96c6;">   </span>end                                                                           x <span style="background: #be96c6;">    </span>end                                                                         </span> <span><a>662</a></span></span>
</div><span class="nodiff" data-left-line="744" data-right-line="663"><a>744</a>                                                                                  .                                                                                  <span><a>663</a></span></span>
<span class="nodiff" data-left-line="745" data-right-line="664"><a>745</a>     %% segmentation and brain mask based on freesurfer output                    .     %% segmentation and brain mask based on freesurfer output                    <span><a>664</a></span></span>
<span class="nodiff" data-left-line="746" data-right-line="665"><a>746</a>     fsnatmask_path = fullfile(mask_path,'native','fs');                          .     fsnatmask_path = fullfile(mask_path,'native','fs');                          <span><a>665</a></span></span>
                                                                      <span class="diffskip">[178 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="925" data-right-line="844"><a>925</a>             fprintf('%s\n',zcmd)                                                 .             fprintf('%s\n',zcmd)                                                 <span><a>844</a></span></span>
<span class="nodiff" data-left-line="926" data-right-line="845"><a>926</a>             system(zcmd,'-echo')                                                 .             system(zcmd,'-echo')                                                 <span><a>845</a></span></span>
<span class="nodiff" data-left-line="927" data-right-line="846"><a>927</a>             %QA                                                                  .             %QA                                                                  <span><a>846</a></span></span>
<div id="diff31" onclick="select('diff31')"><span class="diffLine" data-left-line="928" data-right-line="847"><a>928</a> <span class="diffnomatch"><span style="background: #be96c6;">  %          </span>if n_vp==1                                                          x <span style="background: #be96c6;">            </span>if n_vp==1                                                          </span> <span><a>847</a></span></span>
<span class="diffLine" data-left-line="929" data-right-line="848"><a>929</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>sl = [t1_acpc_dc_rest_fsbrain ' ' bin_out];                     x <span style="background: #be96c6;">                </span>sl = [t1_acpc_dc_rest_fsbrain ' ' bin_out];                     </span> <span><a>848</a></span></span>
<span class="diffLine" data-left-line="930" data-right-line="849"><a>930</a> <span class="diffnomatch"><span style="background: #be96c6;">  %          </span>else                                                                x <span style="background: #be96c6;">            </span>else                                                                </span> <span><a>849</a></span></span>
<span class="diffLine" data-left-line="931" data-right-line="850"><a>931</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>sl = [sl ' ' t1_acpc_dc_rest_fsbrain ' ' bin_out];              x <span style="background: #be96c6;">                </span>sl = [sl ' ' t1_acpc_dc_rest_fsbrain ' ' bin_out];              </span> <span><a>850</a></span></span>
<span class="diffLine" data-left-line="932" data-right-line="851"><a>932</a> <span class="diffnomatch"><span style="background: #be96c6;">  %          </span>end                                                                 x <span style="background: #be96c6;">            </span>end                                                                 </span> <span><a>851</a></span></span>
<span class="diffLine" data-left-line="933" data-right-line="852"><a>933</a> <span class="diffnomatch"><span style="background: #be96c6;">  %          </span>if n_vp==length(vps)                                                x <span style="background: #be96c6;">            </span>if n_vp==length(vps)                                                </span> <span><a>852</a></span></span>
<span class="diffLine" data-left-line="934" data-right-line="853"><a>934</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>cd(qa_path);                                                    x <span style="background: #be96c6;">                </span>cd(qa_path);                                                    </span> <span><a>853</a></span></span>
<span class="diffLine" data-left-line="935" data-right-line="854"><a>935</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>slice = sprintf('slicesdir -o %s', sl);                         x <span style="background: #be96c6;">                </span>slice = sprintf('slicesdir -o %s', sl);                         </span> <span><a>854</a></span></span>
<span class="diffLine" data-left-line="936" data-right-line="855"><a>936</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>fprintf('%s\n', slice);                                         x <span style="background: #be96c6;">                </span>fprintf('%s\n', slice);                                         </span> <span><a>855</a></span></span>
<span class="diffLine" data-left-line="937" data-right-line="856"><a>937</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>system(slice, '-echo');                                         x <span style="background: #be96c6;">                </span>system(slice, '-echo');                                         </span> <span><a>856</a></span></span>
<span class="diffLine" data-left-line="938" data-right-line="857"><a>938</a> <span class="diffnomatch"><span style="background: #be96c6;">  %              </span>movefile(fullfile(qa_path,'slicesdir'), fullfile(qa_path,sprint x <span style="background: #be96c6;">                </span>movefile(fullfile(qa_path,'slicesdir'), fullfile(qa_path,sprintf</span> <span><a>857</a></span></span>
<span class="diffLine" data-left-line="939" data-right-line="858"><a>939</a> <span class="diffnomatch"><span style="background: #be96c6;">  %          </span>end                                                                 x <span style="background: #be96c6;">            </span>end                                                                 </span> <span><a>858</a></span></span>
</div><span class="nodiff" data-left-line="940" data-right-line="859"><a>940</a>         end                                                                      .         end                                                                      <span><a>859</a></span></span>
<span class="nodiff" data-left-line="941" data-right-line="860"><a>941</a>                                                                                  .                                                                                  <span><a>860</a></span></span>
<span class="nodiff" data-left-line="942" data-right-line="861"><a>942</a>         %create total_gm mask in 2mm native and mni space                        .         %create total_gm mask in 2mm native and mni space                        <span><a>861</a></span></span>
                                                                      <span class="diffskip">[10 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="953" data-right-line="872"><a>953</a>         %combine total gm and wm in 2mm mni space                                .         %combine total gm and wm in 2mm mni space                                <span><a>872</a></span></span>
<span class="nodiff" data-left-line="954" data-right-line="873"><a>954</a>         allm = fullfile(fsmni2mmmask_path, 'allm.nii.gz');                       .         allm = fullfile(fsmni2mmmask_path, 'allm.nii.gz');                       <span><a>873</a></span></span>
<span class="nodiff" data-left-line="955" data-right-line="874"><a>955</a>         totgm = fullfile(fsmni2mmmask_path, 'total_gm.nii.gz');                  .         totgm = fullfile(fsmni2mmmask_path, 'total_gm.nii.gz');                  <span><a>874</a></span></span>
<div id="diff32" onclick="select('diff32')"><span class="diffLine" data-left-line="956" data-right-line="875"><a>956</a> <span class="diffnomatch">        <span style="background: #be96c6;">%</span>wm = fullfile(fsmni2mmmask_path, 'wm_aseg.nii.gz');                     x         wm = fullfile(fsmni2mmmask_path, 'wm_aseg.nii.gz');                     </span> <span><a>875</a></span></span>
<span class="diffLine" data-left-line="957" data-right-line="875"><a>957</a> <span class="diffnew left">        wm = fullfile(fsmni2mmmask_path, 'wm.nii.gz'); % Modified by me !! wm_as &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="958" data-right-line="876"><a>958</a>         zcmd = sprintf('fslmaths %s -add %s -bin %s', ...                        .         zcmd = sprintf('fslmaths %s -add %s -bin %s', ...                        <span><a>876</a></span></span>
<span class="nodiff" data-left-line="959" data-right-line="877"><a>959</a>             totgm, wm, allm);                                                    .             totgm, wm, allm);                                                    <span><a>877</a></span></span>
<span class="nodiff" data-left-line="960" data-right-line="878"><a>960</a>         fprintf('%s\n',zcmd)                                                     .         fprintf('%s\n',zcmd)                                                     <span><a>878</a></span></span>
<span class="nodiff" data-left-line="961" data-right-line="879"><a>961</a>         system(zcmd,'-echo')                                                     .         system(zcmd,'-echo')                                                     <span><a>879</a></span></span>
<span class="nodiff" data-left-line="962" data-right-line="880"><a>962</a>     end                                                                          .     end                                                                          <span><a>880</a></span></span>
<span class="nodiff" data-left-line="963" data-right-line="881"><a>963</a> end                                                                              . end                                                                              <span><a>881</a></span></span>
<span class="nodiff" data-left-line="964" data-right-line="882"><a>964</a>                                                                                  .                                                                                  <span><a>882</a></span></span>
<div id="diff33" onclick="select('diff33')"><span class="diffLine" data-left-line="965" data-right-line="882"><a>965</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="966" data-right-line="882"><a>966</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="967" data-right-line="883"><a>967</a> %% create overlap mask for allm                                                  . %% create overlap mask for allm                                                  <span><a>883</a></span></span>
<span class="nodiff" data-left-line="968" data-right-line="884"><a>968</a> if do_overlap                                                                    . if do_overlap                                                                    <span><a>884</a></span></span>
<span class="nodiff" data-left-line="969" data-right-line="885"><a>969</a>     over_path = fullfile(nii_path,'overlap_masks');                              .     over_path = fullfile(nii_path,'overlap_masks');                              <span><a>885</a></span></span>
                                                                       <span class="diffskip">[7 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="977" data-right-line="893"><a>977</a>         if n_vp == 1                                                             .         if n_vp == 1                                                             <span><a>893</a></span></span>
<span class="nodiff" data-left-line="978" data-right-line="894"><a>978</a>             addmasks = vpmask;                                                   .             addmasks = vpmask;                                                   <span><a>894</a></span></span>
<span class="nodiff" data-left-line="979" data-right-line="895"><a>979</a>         else                                                                     .         else                                                                     <span><a>895</a></span></span>
<div id="diff34" onclick="select('diff34')"><span class="diffLine" data-left-line="980" data-right-line="896"><a>980</a> <span class="diffnomatch">            addmasks = [<span style="background: #be96c6;">addmasks</span> ' -add ' vpmask];                               x             addmasks = [<span style="background: #be96c6;">addmasks30</span> ' -add ' vpmask];                            </span> <span><a>896</a></span></span>
</div><span class="nodiff" data-left-line="981" data-right-line="897"><a>981</a>         end                                                                      .         end                                                                      <span><a>897</a></span></span>
<span class="nodiff" data-left-line="982" data-right-line="898"><a>982</a>     end                                                                          .     end                                                                          <span><a>898</a></span></span>
<span class="nodiff" data-left-line="983" data-right-line="899"><a>983</a>     over_out = fullfile(over_path, '30overlap_allm_ero1vox.nii.gz');             .     over_out = fullfile(over_path, '30overlap_allm_ero1vox.nii.gz');             <span><a>899</a></span></span>
                                                                       <span class="diffskip">[8 unmodified lines hidden]</span>
</pre></div></div><div id="bottom"><p>Number of matching lines: 798</p><p>Number of unmatched lines in left file: 193</p>
<p>Number of unmatched lines in right file: 109</p>
</div></body>